# Тестовое задание на позицию Junior Data Science

## Описание задания

Дан видеофайл ```crowd.mp4```. Необходимо написать программу на языке Python, которая будет выполнять детекцию людей и
их отрисовку на этом видео. Также нужно проанализировать полученный результат и сформулировать шаги по дальнейшему
улучшению качества распознавания.

## Установка проекта

### Требования

- Python 3.11 или выше
- pip
- (При первом запуске) Стабильный интернет

### Шаги установки

1. Клонируйте репозиторий:

    ```sh
    git clone https://github.com/RomanYukhatskov/TestBND.git
    ```

2. Создайте виртуальное окружение:

    ```sh
    python -m venv venv
    source venv/bin/activate  # Для Windows: venv\Scripts\activate
    ```

3. Установите зависимости:

    ```sh
    pip install -r requirements.txt
    ```

## Использование

### Запуск проекта

Для запуска проекта выполните следующую команду:

```sh
python main.py
```

После запуска в новом окне будет отображаться результат детекции объектов на каждом кадре.

### Результат работы
После окончания работы программы в консоль будет выведено:
```sh
Video frame is empty or video processing has been successfully completed.
```
Также будет создан видеофайл ```"instance-segmentation-object-tracking.avi"```, который демонстрирует отрисовку людей 
на предоставленном видео.

## Описание и анализ работы детектора

### Описание

Детекция производилась с помощью модели ```YOLO11``` библиотеки ```ultralytics```, а именно использовалась
предобученная для сегментации модель ```YOLO11n-seg``` (веса которой будут скачены в основную директорию проекта при
первом запуске).

[Ссылка на официальную документацию](https://docs.ultralytics.com/models/yolo11/).

Для распознавания использовались параметры по умолчанию:

* Confidence (порог уверенности) - ```conf=0.25```
* Intersection Over Union (Площадь пересечения поделить на площадь объединения) - ```iou=0.7```
* Image size (размер кадра) - ```imgsz=640```
* и др. (подробнее в документации)

### Анализ

Так как для детекции использовалась предобученная модель, то для анализа воспользуемся значениями метрик качества,
посчитанные разработчиками на датасете
[COCO](https://github.com/ultralytics/ultralytics/blob/main/ultralytics/cfg/datasets/coco.yaml):

* ```mAP50-95(mask) = 32.0``` - средняя точность масок сегментации
* ```Params(M) = 2.9``` - количество параметров модели (в млн)
* ```Speed CPU ONNX (ms) = 65.9``` - среднее время обработки одного кадра моделью на CPU (в мс)

Для простой задачи сегментации объектов с использованием крайне ограниченных ресурсов такая модель достаточно хороша.

### Способы улучшения

Если необходимо повысить точность распознавания людей на этом конкретном видео, то есть несколько (невзаимоисключающих)
способов сделать это:

* **Во-первых, изменить параметры распознавания.**
  
   Например, если повысить значение ```confidence```, модель будет отрисовать объекты, которые будут иметь значения
порога уверенности выше или равно заданному; что, с одной стороны, избавит от "шумов" и ложных срабатываний, а с другой,
не отобразит верно распознанные объекты с более низким значением ```confidence```.

* **Во-вторых, воспользоваться версией модели ```YOLO11``` большего размера.**

   В коде проекта использовалась модель ```YOLO11n-seg```, где ```n``` означает ```nano```. Есть ещё ```s``` -
```small```, ```m``` - ```medium```, ```l``` - ```large``` и ```x``` - ```extra-large```. Каждая последующая модель
отличается от предыдущей более высоким ```mAP``` (что делает модель точнее в отрисовке), но также увеличивает
```Params(M)``` и ```Speed CPU ONNX (ms)``` (что делает её более требовательной к вычислительным ресурсам и
медлительной)

   Для сравнения, модель ```YOLO11x-seg``` имеет следующие метрики:
  * ```mAP50-95(mask) = 43.8```
  * ```Params(M) = 62.1```
  * ```Speed CPU ONNX (ms) = 664.5```

* **В-третьих, дообучить модель.**

   Так как требуется распознавать и отрисовывать только людей, то можно подобрать датасет картинок с изображениями людей 
и дообучить модель на нём, оставив только класс ```person```. Тогда модель будет работать только на детекцию людей и не
будет распознавать другие объекты. Это повысит ```mAP``` модели, но сделает её менее универсальной. Также стоит
отметить, что любое дообучение модели требует более значительных ресурсов, чем использование обученной модели.

## Контактные данные

**ФИО**: Юхацков Роман Валерьевич

**Email**: romanyukhatskov@gmail.com